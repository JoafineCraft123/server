<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>IDE Python Leve</title>
<style>
  body, html {
    margin: 0; height: 100%; font-family: monospace; background: #1e1e1e; color: #eee;
    display: flex; flex-direction: column;
  }
  #tabs {
    display: flex; background: #333; padding: 5px;
  }
  #tabs button {
    background: #444; border: none; color: #eee; margin-right: 5px; padding: 5px 10px; cursor: pointer;
  }
  #tabs button.active {
    background: #007acc;
  }
  #main {
    display: flex; flex-grow: 1; height: calc(100vh - 50px);
  }
  #editor {
    flex-grow: 1; border-right: 2px solid #007acc; height: 100%;
  }
  #terminal {
    width: 300px; background: #121212; display: flex; flex-direction: column; height: 100%;
  }
  #terminal-output {
    flex-grow: 1; padding: 10px; overflow-y: auto; white-space: pre-wrap;
  }
  #terminal-input {
    border: none; background: #1e1e1e; color: #eee; font-family: monospace; font-size: 14px;
    padding: 8px; outline: none;
  }
</style>

<!-- Importar CodeMirror 6 básico (mínimo e leve) -->
<script type="module">
  import {EditorState} from "https://cdn.jsdelivr.net/npm/@codemirror/state@6.2.0/dist/index.js";
  import {EditorView, basicSetup} from "https://cdn.jsdelivr.net/npm/@codemirror/basic-setup@6.4.0/dist/index.js";
  import {python} from "https://cdn.jsdelivr.net/npm/@codemirror/lang-python@6.1.0/dist/index.js";

  window.createEditor = (parent, content) => {
    const state = EditorState.create({
      doc: content,
      extensions: [basicSetup, python()]
    });
    const view = new EditorView({
      state,
      parent,
    });
    return view;
  }
</script>

<script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
</head>
<body>

<div id="tabs">
  <button class="tab active" data-file="file1.py">file1.py</button>
  <button class="tab" data-file="file2.py">file2.py</button>
  <button id="new-tab">+</button>
</div>

<div id="main">
  <div id="editor"></div>
  <div id="terminal">
    <div id="terminal-output">(Terminal Python aqui)</div>
    <input id="terminal-input" placeholder="Digite comando Python e Enter" autocomplete="off" />
  </div>
</div>

<script>
  let pyodide = null;
  let editorViews = {};
  let currentFile = 'file1.py';
  let files = {
    'file1.py': "# Código do file1\nprint('Olá mundo')",
    'file2.py': "# Código do file2\nprint('Python online')"
  };

  async function initPyodide() {
    document.getElementById('terminal-output').textContent = 'Carregando Pyodide...';
    pyodide = await loadPyodide();
    document.getElementById('terminal-output').textContent += '\nPronto para comandos Python!';
  }

  function loadFile(file) {
    // Salvar código atual
    if(editorViews[currentFile]) {
      files[currentFile] = editorViews[currentFile].state.doc.toString();
    }
    currentFile = file;

    // Limpa editor e cria novo
    const editorContainer = document.getElementById('editor');
    editorContainer.innerHTML = '';
    editorViews[file] = window.createEditor(editorContainer, files[file]);

    // Atualiza abas
    document.querySelectorAll('#tabs button.tab').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.file === file);
    });
  }

  // Eventos abas
  document.querySelectorAll('#tabs button.tab').forEach(btn => {
    btn.onclick = () => loadFile(btn.dataset.file);
  });

  // Nova aba
  document.getElementById('new-tab').onclick = () => {
    const newFileName = `file${Object.keys(files).length+1}.py`;
    files[newFileName] = '# Novo arquivo\n';
    const btn = document.createElement('button');
    btn.className = 'tab';
    btn.dataset.file = newFileName;
    btn.textContent = newFileName;
    btn.onclick = () => loadFile(newFileName);
    document.getElementById('tabs').insertBefore(btn, document.getElementById('new-tab'));
    loadFile(newFileName);
  };

  async function executarTerminal(comando) {
    try {
      pyodide.runPython(`
import sys
import io
sys.stdout = io.StringIO()
sys.stderr = sys.stdout
      `);
      await pyodide.runPythonAsync(comando);
      let saida = pyodide.runPython('sys.stdout.getvalue()');
      return saida || '(sem saída)';
    } catch (e) {
      return 'Erro: ' + e;
    }
  }

  const termInput = document.getElementById('terminal-input');
  const termOutput = document.getElementById('terminal-output');

  termInput.addEventListener('keydown', async e => {
    if(e.key === 'Enter') {
      e.preventDefault();
      const cmd = termInput.value.trim();
      if(!cmd) return;
      termOutput.textContent += `\n>>> ${cmd}\n`;
      termInput.value = '';
      const res = await executarTerminal(cmd);
      termOutput.textContent += res + '\n';
      termOutput.scrollTop = termOutput.scrollHeight;
    }
  });

  // Inicializar
  loadFile(currentFile);
  initPyodide();

</script>

</body>
</html>
